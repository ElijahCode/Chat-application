(()=>{"use strict";var e={955:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.combineReducers=void 0,t.combineReducers=function(e){return(t,s)=>{const n={};return Object.keys(e).forEach((r=>{n[r]=t?e[r](t[r],s):e[r](t,s)})),n}}},52:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createStore=t.combineReducers=void 0;var n=s(955);Object.defineProperty(t,"combineReducers",{enumerable:!0,get:function(){return n.combineReducers}}),t.createStore=function(e,t,s){const n={state:t,listeners:[],middlewareList:s||[],storeReducer:(t,s)=>e(t,s),getState(){return this.state},dispatch(e){this.middlewareList.length>0?this.middleware(e):this.state=this.storeReducer(this.state,e),this.listeners.forEach((e=>e()))},subscribe(e){return this.listeners.push(e),()=>this.listeners.splice(0)},replaceReducer(e){this.storeReducer=e},middleware(e){if(1===this.middlewareList.length)this.state=this.middlewareList[0](n)((()=>this.storeReducer(this.state,e)))(e);else{let t;this.middlewareList.forEach((s=>{t=s(n)((()=>this.storeReducer(this.state,e)))(e)})),this.state=t}}};return n}},617:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});const n=s.p+"images/sad.png"},885:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});const n=s.p+"images/smile.png"},769:(e,t,s)=>{s.r(t)},757:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createActionGetMessagesList=t.createActionSendMessage=void 0,t.createActionSendMessage=function(e){return{type:"SENDMESSAGE",message:Object.assign({},e)}},t.createActionGetMessagesList=function(e){return{type:"GETMESSAGELIST",messages:e}}},490:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.emoji=void 0,t.emoji=[{regExp:/:\)/gm,name:"smile",source:"./images/smile.png"},{regExp:/:\(/gm,name:"sad",source:"./images/sad.png"}]},11:function(e,t){var s=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.observeWithEventSource=t.sendMessage=t.getMessagesList=void 0;const n="https://chat-application-ca587-default-rtdb.europe-west1.firebasedatabase.app";t.getMessagesList=function(){return s(this,void 0,void 0,(function*(){return fetch(`${n}/messages.json`,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const t=[];return Object.values(e).forEach((e=>{t.push(e)})),t}))}))},t.sendMessage=function(e){return s(this,void 0,void 0,(function*(){return fetch(`${n}/messages.json`,{method:"POST",body:JSON.stringify(Object.assign({},e)),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json()))}))},t.observeWithEventSource=function(e){new EventSource(`${n}/messages.json`).addEventListener("put",(function(t){return e(JSON.parse(t.data).data)}))}},294:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(52),o=s(869),i=s(757),a=s(591),c=s(11),u=s(539);let d;s(769),s(885),s(617),d=""===d?"Anonymous":d,localStorage.getItem("userName")?d=JSON.parse(localStorage.getItem("userName")):(d=prompt("Please, enter you name",""),d=""===d?"Anonymous":d),"Anonymous"!==d&&localStorage.setItem("userName",JSON.stringify(d));const l={userName:d,messages:[]},g=r.createStore(o.reducer,l,[]),p=document.querySelector(".messageBox"),h=document.querySelector(".sendButton"),m=document.querySelector(".messagesHistory");function f(){return n(this,void 0,void 0,(function*(){const e=p.value,t={name:d,message:e,now:Date.now()};p.value="";try{yield c.sendMessage(t),g.dispatch(i.createActionSendMessage(t))}catch(e){alert("Your message is not sending, try later!")}g.dispatch(i.createActionSendMessage(t))}))}g.subscribe((()=>{u.render(g.getState()),m.scrollTop=m.scrollHeight})),h.addEventListener("click",f),p.addEventListener("keydown",(e=>{"Enter"===e.code&&f()})),c.observeWithEventSource((()=>n(void 0,void 0,void 0,(function*(){yield a.loadMessage(g)})))),n(void 0,void 0,void 0,(function*(){yield a.loadMessage(g),m.scrollTop=m.scrollHeight}))},591:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.loadMessage=void 0;const r=s(11),o=s(757);t.loadMessage=function(e){return n(this,void 0,void 0,(function*(){const t=yield r.getMessagesList();e.dispatch(o.createActionGetMessagesList(t))}))}},869:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=void 0,t.reducer=function(e,t){const s=Object.assign({},e);switch(t.type){case"SENDMESSAGE":s.messages.push(Object.assign({},t.message));break;case"GETMESSAGELIST":s.messages=t.messages}return s}},539:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.render=void 0;const n=s(490);t.render=function(e){const t=document.querySelector(".messagesHistory");let s="";e.messages.forEach((t=>{const n=new Date(t.now);t.name===e.userName&&"Anonymous"!==t.name?s+=`<div class ="userMessageBlock"><p class="messageHeader">${t.name} wrote at ${n.getDate()}.${n.getMonth()+1}.${n.getFullYear()} ${n.getHours()}:${n.getMinutes()}</p><p class ="message">${t.message}</p></div>\n`:s+=`<div class ="messageBlock"><p class="messageHeader">${t.name} wrote at ${n.getDate()}.${n.getMonth()+1}.${n.getFullYear()} ${n.getHours()}:${n.getMinutes()}</p><p class ="message">${t.message}</p></div>\n`})),n.emoji.forEach((e=>{s=s.replace(e.regExp,`<img class="emoji" src=${e.source} heigth=20px width=20px>`)})),t.innerHTML=s}}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,s),o.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s(294)})();